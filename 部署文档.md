
---
修改config文件的如下代码
---


```python
class Config:
    # LLM 配置
    VLLM_HOST = "http://localhost:8000/v1"
    LLM_MODEL = "Qwen3-8B"

    EMBEDDING_HOST = "http://10.130.37.7:8000/v1"
    EMBEDDING_MODEL = "Qwen3-Embedding-8B"
    KNOWLEDGE_BASE_DIR = "my_knowledge_base/rag_kb/kb"
    KNOWLEDGE_BASE_EXAMPLE_LIBRARY_DIR = "my_knowledge_base/icl_knowledge_base"
    KNOWLEDGE_SQL_DIR = "my_knowledge_base/sql/入湖总表_.csv"

    # 数据库配置
    CK_HOST='127.0.0.1',   # 数据库主机地址
    CK_PORT=8123,            # HTTP 接口端口（默认8123）
    CK_USERNAME='default',     # 用户名
    CK_PASSWORD='12345678',    # 密码（如果有）
    CK_DATABASE='default'    # 默认数据库
```
1. 模型信息配置
```python
VLLM_HOST = "http://localhost:8000/v1"
LLM_MODEL = "Qwen3-8B"

EMBEDDING_HOST = "http://10.130.37.7:8000/v1"
EMBEDDING_MODEL = "Qwen3-Embedding-8B"
```

2. clickhouse_connect修改
```python
CK_HOST='127.0.0.1',   # 数据库主机地址
CK_PORT=8123,            # HTTP 接口端口（默认8123）
CK_USERNAME='default',     # 用户名
CK_PASSWORD='12345678',    # 密码（如果有）
CK_DATABASE='default'    # 默认数据库
```

3. 检索文件路径
```python
KNOWLEDGE_BASE_DIR = "my_knowledge_base/rag_kb/kb"
KNOWLEDGE_BASE_EXAMPLE_LIBRARY_DIR = "my_knowledge_base/icl_knowledge_base" 
```
其中
`KNOWLEDGE_BASE_DIR`为检索表名用到的知识库所在文件夹
`KNOWLEDGE_BASE_EXAMPLE_LIBRARY_DIR`为检索相关案例知识库所在文件夹






---
FastAPI运行main_api文件的如下代码
---
安装必要库
```bash
pip install fastapi uvicorn
```

python -m uvicorn main_api:app --reload --port 8888 

4. 终端启动FastAPI服务：
`main_api.py`是非流式输出，`main_stream_api.py`为流式输出
```bash
python -m uvicorn main_api:app --reload --host 0.0.0.0 --port 8888 
```
其中 `--reload` 参数的作用是开发时自动重启服务：当你修改了 Python 源代码文件（比如 main_api.py 或其导入的模块）并保存后，Uvicorn 会自动检测到文件变化，并重新启动服务器。

生产部署时可用下面的代码
```bash
python -m uvicorn main_api:app --host 0.0.0.0 --port 8888
```
或部署流式输出的
```bash
python -m uvicorn main_stream_api:app --host 0.0.0.0 --port 8888 
```
8888被占可以换个端口

终端输入
```bash
curl -X 'POST' \
  'http://127.0.0.1:8888/query' \
  -H 'Content-Type: application/json' \
  -d '{"question": "今年宁德1号机有哪些【日常】类描述NG单？"}'
```
或
```bash
curl -X 'POST' \
  'http://127.0.0.1:8888/query' \
  -H 'Content-Type: application/json' \
  -d '{"question": "大修报告主表里阳江1号机各“报告状态”的大修报告数量占比怎么分布？（输出饼图）"}'
```

question=$(python3 -c "import urllib.parse; print(urllib.parse.quote('大修报告主表里阳江1号机各“报告状态”的大修报告数量占比怎么分布？（输出饼图）'))")
curl -N "http://127.0.0.1:8888/query?question=$question"

示例输出
```JSON
{
  "status": "success",
  "sql": "",
  "result":{
    "chartData": {
      "type": "bar",
      "title": "各地区销售额对比",
      "data": {
        "labels": ["华东", "华南", "华北"],
        "datasets": [
          {
            "label": "销售额（万元）",
            "data": [120, 95, 80]
          }
        ]
      }
    },
    "markdownReport": "## 分析报告\\n\\n| 地区 | 销售额（万元） |\\n|------|----------------|\\n| 华东 | 120            |\\n| 华南 | 95             |\\n| 华北 | 80             |\\n\\n从数据可见，华东地区贡献最高销售额，建议加强华南市场投入。\\n\\n*数据来源表名：sales_summary*"
  },
  "message": ""
}
```